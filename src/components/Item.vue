<template>    <div        :class="mainStore.operationList.indexOf(id.toString()) !== -1 ? 'item seled' : 'item'"        draggable="true" @click="getInDir(id)" @mousedown.stop @mouseenter="addDragMoveList(id)"        @mouseleave="removeDragMoveList(id)" @drop="dragMove(id, filetype)"    >        <input type="checkbox" :value="id" @click.stop v-model="mainStore.operationList">        <div class="img" v-if="filetype === 0">            <img draggable="false" class="fileImg" :src="file" alt="">        </div>        <div class="img" v-if="filetype === 99">            <img draggable="false" class="dir" :src="dir" alt="">        </div>        <div class="img" v-if="filetype === 2">            <n-image                @click.stop                :img-props="{                    src: url,                    draggable: false,                    style: 'max-height:96px;max-width:110px'                }"                :fallback-src="file"                :preview-src="url"                ref="image"            />        </div>        <div class="img" v-if="filetype === 4">            <img draggable="false" class="fileImg" :src="file" alt="">        </div>        <div class="name">            {{ name.length > 13 ? name.substring(0, 13) + '...' : name }}        </div>        <div class="datetime">            {{ datetime.replace('T', ' ').replace('-', '/').replace('-', '/').split('.')[0] }}        </div>    </div></template><script>import dir from '../assets/img/dir.png'import md from '../assets/img/md.png'import txt from '../assets/img/txt.png'import zip from '../assets/img/zip.png'import file from '../assets/img/文件.png'import {useMainStore} from '@/store'import {useRouter, useRoute} from 'vue-router'import {useMessage, NImage} from 'naive-ui'import request from '@/utils/request'import {DownloadURL, DragMoveURL} from '@/utils/Constant'import {onBeforeUnmount, onMounted, ref, getCurrentInstance} from 'vue'export default {    name: 'Item',    props: ['id', 'name', 'filetype', 'datetime'],    components: {NImage},    setup(props){        let mainStore = useMainStore()        let router = useRouter()        let route = useRoute()        let message = useMessage()        let url = ref(null)        let image        function getBlob(){            request.get(DownloadURL + props.id, {                responseType: 'blob',            }).then((res) => {                console.log(res.data)                if (res.data.type !== "application/json"){                    let blob = new Blob([res.data])                    url.value = URL.createObjectURL(blob)                    if (props.filetype === 4) {                        window.open(`${window.location.protocol}//${window.location.host}/file/pdfjs/web/viewer.html?file=${encodeURIComponent(url.value)}`)                    }                }            })        }        onMounted(() => {            if (props.filetype !== 0 && props.filetype === 2){                getBlob()            }            image = getCurrentInstance().refs.image        })        onBeforeUnmount(() => {            URL.revokeObjectURL(url.value)        })        function getInDir(id){            mainStore.dragMoveList.length = 0            if (props.filetype === 99){                if (mainStore.isShare){                    router.push('/share/' + id + '?share_id=' + route.query.share_id)                } else if (mainStore.status === 0) {                    router.push('/recycle-bin/' + id)                } else {                    router.push('/file/' + id)                }            } else if (props.filetype === 4){                getBlob()            } else if (props.filetype === 2) {                image.click()            } else {                message.info("该类型暂不支持在线预览")            }        }        function removeDragMoveList(id){            mainStore.dragMoveList.splice(mainStore.dragMoveList.indexOf(id), 1)        }        function addDragMoveList(id){            mainStore.dragMoveList.push(id)        }        function dragMove(id, filetype){            if (mainStore.dragMoveList.indexOf(id) !== -1 || mainStore.operationList.length === 0){                return            }            if (filetype === 99){                request.get(DragMoveURL + '?operationList=' + mainStore.dragMoveList + '&parentId=' + id).then(res => {                    if (res.data.code === 0){                        message.success('操作成功')                        mainStore.init()                        mainStore.operationList.length = 0                    } else {                        message.error(res.data.msg)                    }                })            }        }        return {            dir, md, txt, zip, file,            mainStore,            url,            getInDir,            addDragMoveList,            removeDragMoveList,            dragMove,        }    }}</script><style scoped>.item{    width: 123px;    display: flex;    flex-direction: column;    border-radius: 10px;    cursor: pointer;    margin: 10px 20px;    min-height: 162px;}.item:hover{    background-color: #f1f1f1;}.item .datetime{    font-size: 12px;    color: #bdbdbd;    text-align: center;}.item .name{    display: flex;    justify-content: center;}.item .img{    width: 100%;    height: 96px;    display: flex;    align-items: center;    justify-content: center;}.item .fileImg{    width: 96px;}.item .dir{    height: 96px;}</style>