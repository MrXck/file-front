<template>    <n-space vertical>        <n-layout>            <Header/>            <n-layout has-sider>                <n-layout-sider                    bordered                    collapse-mode="width"                    :collapsed-width="64"                    :width="240"                    :collapsed="collapsed"                    show-trigger                    @collapse="collapsed = true"                    @expand="collapsed = false"                >                    <n-menu                        v-model:value="activeKey"                        :collapsed="collapsed"                        :collapsed-width="64"                        :collapsed-icon-size="22"                        :options="menuOptions"                    />                </n-layout-sider>                <n-layout>                    <div class="head">                        <div class="left">                            <n-breadcrumb separator=">">                                <n-breadcrumb-item>                                    <RouterLink :to="mainStore.status === 1 ? mainStore.isShare ? '/share/0?share_id=' + mainStore.shareId : '/file/0' : '/recycle-bin/0'">{{ mainStore.text }}</RouterLink>                                </n-breadcrumb-item>                                <n-breadcrumb-item v-for="item in mainStore.breadList" :key="item[0]">                                    <RouterLink :to="mainStore.status === 1 ? mainStore.isShare ? '/share/' + item[0] + '?share_id=' + mainStore.shareId : '/file/' + item[0] : '/recycle-bin/' + item[0]">{{ item[1] }}</RouterLink>                                </n-breadcrumb-item>                            </n-breadcrumb>                            <n-checkbox :checked="isAll"                                        @click="allClick">                                共 {{ mainStore.fileList.length }} 项                            </n-checkbox>                        </div>                        <div class="right">                            <n-dropdown size="medium" trigger="click" :options="option" @select="handleSelect">                                <n-button>操作</n-button>                            </n-dropdown>                        </div>                        <n-modal                            v-model:show="newDirModal"                            class="custom-card"                            preset="card"                            title="新建文件夹"                            style="max-width: 400px"                        >                            <n-input type="text" placeholder="请输入文件夹名称" @update:value="updateCreateDirName" @keyup.enter="createDir"/>                            <template #footer>                                <n-space justify="end">                                    <n-button type="success" @click="createDir">提交</n-button>                                </n-space>                            </template>                        </n-modal>                        <input class="hidden" type="file" id="uploadFiles" multiple/>                        <input class="hidden" type="file" id="uploadDir" multiple webkitdirectory/>                        <n-modal                            v-model:show="uploadModal"                            class="custom-card"                            preset="card"                            title="上传文件"                            style="max-width: 400px"                        >                            <n-space vertical>                                <n-button @click="uploadFiles">上传文件</n-button>                                <n-button @click="uploadDir">上传文件夹</n-button>                            </n-space>                            <template #footer>                                <n-space justify="end">                                    <n-button type="success" @click="upload">提交</n-button>                                </n-space>                            </template>                        </n-modal>                        <n-modal                            v-model:show="moveModal"                            class="custom-card"                            preset="card"                            title="移动到"                            style="max-width: 400px"                        >                            <n-space vertical>                                <n-breadcrumb separator=">">                                    <n-breadcrumb-item>                                        <span :class="mainStore.parent_id === 0 ? 'active move' : 'move'"                                              @click="inDir(0)">{{ mainStore.text }}</span>                                    </n-breadcrumb-item>                                    <n-breadcrumb-item v-for="item in mainStore.dirBreadList" :key="item[0]">                                        <span :class="mainStore.parent_id === item[0] ? 'active move' : 'move'"                                              @click="inDir(item[0])">{{ item[1] }}</span>                                    </n-breadcrumb-item>                                </n-breadcrumb>                                <div class="dir">                                    <div class="move-list" v-for="item in mainStore.dirMoveList" :key="item.id" @click="inDir(item.id)">                                        <img :src="dir" alt="">                                        <span>{{item.filename}}</span>                                    </div>                                </div>                            </n-space>                            <template #footer>                                <n-space justify="end">                                    <n-button type="success" @click="move">提交</n-button>                                </n-space>                            </template>                        </n-modal>                        <n-modal v-model:show="deleteModal" preset="dialog" title="Dialog">                            <template #header>                                <div>删除文件</div>                            </template>                            <div>确定要删除这{{mainStore.operationList.length}}项吗？</div>                            <template #action>                                <n-button type="success" @click="deleteFiles">删除</n-button>                            </template>                        </n-modal>                        <n-modal                            v-model:show="renameModal"                            class="custom-card"                            preset="card"                            title="重命名"                            style="max-width: 400px"                        >                            <n-input type="text" placeholder="重命名" @keyup.enter="rename" @update:value="renameFile"/>                            <template #footer>                                <n-space justify="end">                                    <n-button type="success" @click="rename">提交</n-button>                                </n-space>                            </template>                        </n-modal>                        <n-modal                            v-model:show="shareModal"                            class="custom-card"                            preset="card"                            title="分享"                            style="max-width: 400px"                        >                            <n-space vertical>                                <n-space vertical>                                    点击分享后下面出现分享链接                                    <n-input type="text" placeholder="" v-model:value="url" readonly/>                                </n-space>                                <n-space vertical>                                    分享密码(自动生成)                                    <n-input type="text" placeholder="" v-model:value="password" readonly/>                                </n-space>                                <n-space vertical>                                    选择分享有效期                                    <n-select v-model:value="sharePeriod" :default-value="1440" :options="options"/>                                </n-space>                            </n-space>                            <template #footer>                                <n-space justify="end">                                    <n-button type="success" @click="share">分享</n-button>                                </n-space>                            </template>                        </n-modal>                        <n-modal                            v-model:show="collectModal"                            class="custom-card"                            preset="card"                            title="保存到"                            style="max-width: 400px"                        >                            <n-space vertical>                                <n-breadcrumb separator=">">                                    <n-breadcrumb-item>                                        <span :class="mainStore.parent_id === 0 ? 'active move' : 'move'"                                              @click="inDir(0)">{{ mainStore.text }}</span>                                    </n-breadcrumb-item>                                    <n-breadcrumb-item v-for="item in mainStore.dirBreadList" :key="item[0]">                                        <span :class="mainStore.parent_id === item[0] ? 'active move' : 'move'"                                              @click="inDir(item[0])">{{ item[1] }}</span>                                    </n-breadcrumb-item>                                </n-breadcrumb>                                <div class="dir">                                    <div class="move-list" v-for="item in mainStore.dirMoveList" :key="item.id"                                         @click="inDir(item.id)">                                        <img :src="dir" alt="">                                        <span>{{ item.filename }}</span>                                    </div>                                </div>                            </n-space>                            <template #footer>                                <n-space justify="end">                                    <n-button type="success" @click="collect">提交</n-button>                                </n-space>                            </template>                        </n-modal>                        <n-modal                            v-model:show="mainStore.updateUserDetailModal"                            class="custom-card"                            preset="card"                            title="编辑用户信息"                            style="max-width: 400px"                        >                            <n-space vertical>                                <n-space vertical>                                    用户名                                    <n-input type="text" placeholder="请输入用户名" v-model:value="user.username"/>                                </n-space>                                <n-space vertical>                                    密码                                    <n-input type="password" @keyup.enter="updateUserDetail" placeholder="不输入则不修改" v-model:value="user.password"/>                                </n-space>                            </n-space>                            <template #footer>                                <n-space justify="end">                                    <n-button type="success" @click="updateUserDetail">提交</n-button>                                </n-space>                            </template>                        </n-modal>                    </div>                    <n-scrollbar style="height: calc(100vh - 56px - 91px)">                        <router-view/>                    </n-scrollbar>                </n-layout>            </n-layout>        </n-layout>    </n-space>    <div v-show="uploadProgress" class="upload_progress" id="upload_progress" :style="mainStore.isDark ? 'color: #d4d4d5' : ''">        <div class="title">            <span>上传</span>            <n-button text style="font-size: 20px" @click="uploadProgress = !uploadProgress">                <n-icon>                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24">                        <g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"                           stroke-linejoin="round">                            <path d="M18 6L6 18"></path>                            <path d="M6 6l12 12"></path>                        </g>                    </svg>                </n-icon>            </n-button>        </div>        <div class="progress">        </div>    </div></template><script>import {NIcon, NLayout, NMenu, NSpace, NLayoutSider, NScrollbar, NBreadcrumb, NBreadcrumbItem, NCheckbox, NDropdown, NButton, NModal, NInput, useMessage, NSelect, NDivider} from "naive-ui";import {h, ref, watch, reactive, computed, onMounted} from 'vue'import {RouterLink, useRoute} from "vue-router";import {SparklesOutline,} from "@vicons/ionicons5";import Header from './Header'import {useMainStore} from '@/store'import {bigFile, frameSelection, upload_file} from '@/hooks/useMenu'import request from '@/utils/request'import {    CreateDirURL,    DeleteURL,    DirListURL, DownloadFilesURL, FileChunkSize,    GetShareFilesURL,    MoveURL,    RenameURL,    RestoreURL,    ShareURL, UpdateUserDetailURL,} from '@/utils/Constant'import dir from '../assets/img/dir.png'function renderIcon(icon) {    return () => h(NIcon, null, {default: () => h(icon)});}const menuOptions = reactive([    {        label: () => <RouterLink to='/file'>文件</RouterLink>,        key: "/file",        icon: renderIcon(SparklesOutline)    },    {        label: () => <RouterLink to='/recycle-bin'>回收站</RouterLink>,        key: "/recycle-bin",        icon: renderIcon(SparklesOutline)    },]);export default {    name: 'Menu',    setup() {        let route = useRoute();        let activeKey = ref(route.path)        let mainStore = useMainStore()        let showDropdown = ref(false)        let message = useMessage()        let newDirModal = ref(false)        let uploadModal = ref(false)        let moveModal = ref(false)        let deleteModal = ref(false)        let renameModal = ref(false)        let collectModal = ref(false)        let shareModal = ref(false)        let sharePeriod = ref(1440)        let url = ref()        let password = ref()        let user = ref({})        user.value = JSON.parse(localStorage.getItem('user'))        let uploadProgress = ref(false)        let option = reactive([])        function initOption(path){            if (path.includes('recycle-bin')) {                option.length = 0                mainStore.isShare = false                option.push(...[                    {                        label: "删除",                        key: "delete"                    },                    {                        label: "从回收站恢复",                        key: "restore"                    },                ])            } else if (path.includes('file')) {                option.length = 0                mainStore.isShare = false                option.push(...[                    {                        label: "新建文件夹",                        key: "new"                    },                    {                        label: "上传文件",                        key: "upload"                    },                    {                        label: "移动",                        key: "move"                    },                    {                        label: "删除",                        key: "delete"                    },                    {                        label: "下载",                        key: "download"                    },                    {                        label: "重命名",                        key: "rename"                    },                    {                        label: "分享",                        key: "share"                    }                ])            } else {                option.push({                    label: "收藏",                    key: "collect"                })            }        }        watch(() => route.path, (newVal) => {            activeKey.value = newVal;            initOption(route.path)        });        onMounted(() => {            frameSelection(mainStore, message, uploadProgress)            initOption(route.path)        })        let isAll = computed(() => {            return (mainStore.fileList.length === mainStore.operationList.length) && mainStore.fileList.length > 0        })        function allClick(){            let checkboxList = $('input[type="checkbox"]')            if (!isAll.value) {                mainStore.operationList.length = 0                checkboxList.prop("checked", !isAll.value)                for (let i = 0; i < checkboxList.length; i++) {                    mainStore.operationList.push(checkboxList.eq(i).val())                }            } else {                mainStore.operationList.length = 0            }        }        function handleSelect(key){            if (key === 'new'){                newDirModal.value = true            } else if (key === 'upload'){                uploadModal.value = true            } else if (key === 'move'){                if(mainStore.operationList.length > 0){                    getDirList()                    moveModal.value = true                } else {                    message.info('请选择至少一项后进行此操作')                }            } else if (key === 'delete'){                deleteModal.value = true            } else if (key === 'download'){                if (mainStore.operationList.length > 0){                    downloadFiles()                } else {                    message.info('请选择至少一项后进行此操作')                }            } else if (key === 'rename'){                if (mainStore.operationList.length === 1) {                    renameModal.value = true                } else {                    message.info('请选择一项后进行此操作')                }            } else if (key === 'share'){                if (mainStore.operationList.length > 0) {                    shareModal.value = true                } else {                    message.info('请选择至少一项后进行此操作')                }            } else if (key === 'restore'){                restoreFiles()            } else if (key === 'collect'){                getDirList()                collectModal.value = true            }        }        function getDirList(){            request.post(DirListURL, {parentId: mainStore.parent_id}).then((res) => {                if (res.data.code === 0) {                    mainStore.dirMoveList = res.data.data                    mainStore.dirBreadList = res.data.bread                }            })        }        function updateCreateDirName(value){            mainStore.createDirName = value        }        function createDir(){            request.post(CreateDirURL, {fileId: mainStore.file_id, dirName: mainStore.createDirName}).then(res => {                if (res.data.code === 0) {                    message.success(res.data.msg)                    mainStore.init()                } else {                    message.error(res.data.msg)                }            }).finally(() => {                newDirModal.value = false                mainStore.createDirName = ''            })        }        function uploadFiles(){            $('#uploadFiles').click()        }        function uploadDir() {            $('#uploadDir').click()        }        function upload(){            uploadProgress.value = true            let uploadDir = $('#uploadDir')[0]            let uploadFiles = $('#uploadFiles')[0]            for (let i = 0; i < uploadDir.files.length; i++) {                if (uploadDir.files[i].size > FileChunkSize) {                    bigFile(uploadDir.files[i], mainStore, message, uploadDir.files[i].name)                } else {                    upload_file(uploadDir.files[i], mainStore, message, uploadDir.files[i].name)                }            }            for (let i = 0; i < uploadFiles.files.length; i++) {                if (uploadFiles.files[i].size > FileChunkSize) {                    bigFile(uploadFiles.files[i], mainStore, message, uploadFiles.files[i].name)                } else {                    upload_file(uploadFiles.files[i], mainStore, message, uploadFiles.files[i].name)                }            }            uploadModal.value = false        }        function move(){            request.post(MoveURL, {                operationList: mainStore.operationList,                parentId: mainStore.parent_id            }).then((res) => {                if (res.data.code === 0) {                    message.success(res.data.msg)                } else {                    message.error(res.data.msg)                }            }).finally(() => {                mainStore.init()                moveModal.value = false            })        }        function inDir(id){            mainStore.parent_id = id            getDirList()        }        function deleteFiles(){            request.post(DeleteURL, {operationList: mainStore.operationList}).then((res) => {                if (res.data.code === 0) {                    message.success(res.data.msg)                } else {                    message.error(res.data.msg)                }            }).finally(() => {                mainStore.init()                deleteModal.value = false            })        }        function downloadFiles(){            let id = mainStore.operationList[0]            let filename = '';            for (let i = 0; i < mainStore.fileList.length; i++) {                if (mainStore.fileList[i].id === parseInt(id)) {                    filename = mainStore.fileList[i].filename                }            }            request.get(DownloadFilesURL + "?operationList=" + mainStore.operationList, {                responseType: 'blob',            }).then((res) => {                let blob = new Blob([res.data])                let url = URL.createObjectURL(blob)                let a = document.createElement('a')                a.href = url                a.download = `${filename}等${mainStore.operationList.length}个文件.zip`                a.click()                URL.revokeObjectURL(url)            })        }        function renameFile(value){            mainStore.rename = value        }        function rename(){            request.get(RenameURL, {                params: {                    operationList: mainStore.operationList[0],                    rename: mainStore.rename,                    parentId: mainStore.file_id                }            }).then((res) => {                if (res.data.code === 0) {                    message.success(res.data.msg)                } else {                    message.error(res.data.msg)                }            }).finally(() => {                mainStore.init()                renameModal.value = false                mainStore.rename = ''            })        }        function share(){            request.post(ShareURL, {                operationList: mainStore.operationList,                period: sharePeriod.value            }, {headers: {'Content-Type': 'application/json;charset=UTF-8'}}).then((res) => {                if (res.data.code === 0) {                    mainStore.shareId = res.data.url                    url.value = location.host + '/#/share?share_id=' + mainStore.shareId                    password.value = res.data.password                } else {                    message.error(res.data.msg)                }            })        }        function restoreFiles(){            request.get(RestoreURL + '?operationList=' + mainStore.operationList).then((res) => {                if (res.data.code === 0) {                    message.success(res.data.msg)                } else {                    message.error(res.data.msg)                }            }).finally(() => {                mainStore.init()            })        }        function collect(){            request.post(GetShareFilesURL, {                operationList: mainStore.operationList,                parentId: mainStore.parent_id,                password: mainStore.sharePassword,                shareId: mainStore.shareId,            }).then((res) => {                if (res.data.code === 0) {                    message.success(res.data.msg)                } else {                    message.error(res.data.msg)                }            }).finally(() => {                collectModal.value = false            })        }        function updateUserDetail(){            request.post(UpdateUserDetailURL, user.value).then(res => {                if (res.data.code === 0) {                    message.success('修改成功')                    localStorage.setItem('user', JSON.stringify(res.data.data))                    location.reload()                } else {                    message.error(res.data.msg)                }            })        }        return {            collapsed: ref(false),            menuOptions,            activeKey,            mainStore,            showDropdown,            option,            newDirModal,            uploadModal,            moveModal,            deleteModal,            renameModal,            shareModal,            collectModal,            sharePeriod,            url,            user,            password,            uploadProgress,            options: [                {                    label: "30分钟",                    value: 30                },                {                    label: "1小时",                    value: 60                },                {                    label: "5小时",                    value: 300                },                {                    label: "24小时",                    value: 1440                },            ],            isAll,            allClick,            handleSelect,            updateCreateDirName,            createDir,            uploadFiles,            uploadDir,            upload,            move,            inDir,            deleteFiles,            renameFile,            rename,            share,            collect,            updateUserDetail,            dir,        };    },    components: {        Header,        NIcon,        NLayout,        NMenu,        NSpace,        NLayoutSider,        NScrollbar,        NBreadcrumb,        NBreadcrumbItem,        NCheckbox,        NDropdown,        NButton,        NModal,        NInput,        NSelect,        NDivider,    }}</script><style scoped>.head{    padding: 20px;    display: flex;    justify-content: space-between;}.n-breadcrumb-item{    font-size: 18px;    font-weight: bold;}.bread{    cursor: pointer;}.hidden{    display: none;}.move{    font-size: 14px;    cursor: pointer;}.active{    font-weight: bold;}.move-list{    display: flex;    height: 20px;    cursor: pointer;    padding: 10px;    border-radius: 5px;}.move-list:hover{    background-color: #eaeaea;}.move-list span{    padding: 0 10px;}.dir{    max-height: 200px;    overflow: auto;}#upload_progress {    position: fixed;    bottom: 20px;    right: 20px;    width: 350px;    max-height: 400px;    overflow: auto;    box-shadow: 0 0 1px 1px rgba(28, 28, 32, .05), 0 8px 24px rgba(28, 28, 32, .12);    border: 1px solid rgba(132, 133, 141, 0.08);    border-radius: 5px;}#upload_progress .title{    display: flex;    justify-content: space-between;    padding: 20px;    font-size: 18px;    align-items: center;}#upload_progress .progress{    padding: 10px;}</style>